<html>

<head>
    <title>
        Lions are the best
    </title>
    
    <style>
        img {
          image-rendering: pixelated;
        }
    </style>
</head>

<body onload=setup()>
    <h1>
		Project Lazer Lions
	</h1>

    <img src="images/Sprite2biggermane.png" width=100>
    </img>

    <a href="http://reddit.com/r/lions">
		Roar
	</a>

    <p id="nameTag">
        Lions name is:
    </p>

    <p>
        Rename:
        <input id="nameTextbox" onkeypress="textBoxKeyPress(event)">
        </input>

        <input type=button value="enter" onclick=nameTheLion()>
        </input>
    </p>

    <p id="ageTag">
        Age:
    </p>

    <p id="foodTag">
        Favourite Food:
    </p>

    <p id="personalityTag">
        Personality:
        <ul id="traitsList">
            <li>
            </li>
            <li>
            </li>
            <li>
            </li>
        </ul>
    </p>

    <p>Your Lions:
        <select id="lionSelect" onchange="selectLion(this)">
        </select>
    </p>

    <input type=button value="restart" onclick=restart()>
    </input>

</body>

<script>
    var lions;
    var lionInfo;
    var selectedLion;

    var foods = [
        "Cookies",
        "Waffles",
        "Muffins",
        "Sour Gummy Bears",
        "Spaghetti",
        "Cheese Burger",
        "Watermelon",
    ];
    
    var desires = [
        {
            action: "eat",
            more: "hungry",
            less: "light eater",
        },
        {
            action: "sleep",
            more: "tired",
            less: "energetic",
        },
        {
            action: "play",
            more: "playful",
            less: "serious",
        },
        {
            action: "give present",
            more: "generous",
            less: "hoarder",
        },
        {
            action: "be pet",
            more: "affectionate",
            less: "reserved",
        },
        {
            action: "fight",
            more: "brave",
            less: "nervous",
        },
        {
            action: "be photographed",
            more: "proud",
            less: "shy",
        },
        {
            action: "love",
            more: "charming",
            less: "reserved",
        },
        {
            action: "befriend",
            more: "friendly",
            less: "loner",
        },
        {
            action: "have an egg",
            more: "impulsive",
            less: "cautious",
        },
        {
            action: "raise a cub",
            more: "nuturing",
            less: "free",
        },
        {
            action: "grow up",
            more: "mature",
            less: "youthful",
        },
        {
            action: "take medicine",
            more: "delicate",
            less: "hearty",
        }
    ];

    var setup = function () {
        load_from_cookie();
        lions = game_data.lions;
        if (lions) {
            selectedLion = 0;
            lionInfo = lions[selectedLion];
        } else {
           restart(); 
        }
        
        updatePage();
    };
    
    var restart = function () {
        createLions();
        updateSaveData();
        updatePage();
    };
    
    var createLions = function () {
        var lionsToCreate = 3;
        lions = [];
        
        var l;
        for (l = 0; l < lionsToCreate; l++) {
            var newLion = createLion();
            lions.push(newLion);
        }
        selectedLion = 0;
        lionInfo = lions[selectedLion];
    };

    var createLion = function () {
        var lionInfo = {};
        lionInfo.name = "unnamed";
        lionInfo.age = "Adult";
        //lionInfo.personalityTag=

        var foodIndex = Math.random();
        foodIndex = foodIndex * foods.length;
        foodIndex = Math.floor(foodIndex);
        console.log("foodIndex:" + foodIndex);

        lionInfo.food = foods[foodIndex];
        
        
        //deside traits
        lionInfo.traits = [];
        
        //creates a copy of the array
        var availableDesires = desires.slice(0);
        
        while (lionInfo.traits.length < 3) {
            
            var desireIndex = Math.floor(Math.random() * availableDesires.length);
            var desire = availableDesires[desireIndex];
            
            //remove the chosen one from list of available options
            availableDesires.splice(desireIndex, 1);
            
            var desireLevel = Math.floor(Math.random() * 2);
            
            var trait;
            if (desireLevel == 0) {
                trait = desire.less;
            } else {
                trait = desire.more;
            }
            lionInfo.traits.push(trait);
        }
        
        console.log(lionInfo.traits);
        
        return lionInfo;
    };

    var updatePage = function () {
        var nametag = document.getElementById("nameTag");
        var ageTag = document.getElementById("ageTag");
        var favefood = document.getElementById("foodTag");

        nametag.textContent = "Lions name is: " + lionInfo.name;
        ageTag.textContent = "Age: " + lionInfo.age;
        favefood.textContent = "Favourite Food: " + lionInfo.food;
        
        var nameTextbox = document.getElementById("nameTextbox");
        nameTextbox.value = "";
        
        updateLionSelect();
        updateTraitList();
    };
    
    var updateTraitList = function () {
        var traitsList = document.getElementById("traitsList");
        
        //remove old items
        while (traitsList.getElementsByTagName("li").length > 0) {
            traitsList.removeChild(traitsList.firstChild);
        }
        
        //add new items
        var loopCount = 0;
        while (loopCount < lionInfo.traits.length) {
            var trait = lionInfo.traits[loopCount];
            var traitItem = document.createElement("li");
            traitItem.textContent = trait;
            traitsList.appendChild(traitItem);
        
            loopCount += 1;
        }
    };
    
    var updateLionSelect = function () {
        var lionSelect = document.getElementById("lionSelect");
        
        //remove old options
        while (lionSelect.length > 0) {
            lionSelect.removeChild(lionSelect.firstChild);
        }
        
        //add new options
        var loopCount = 0;
        while (loopCount < lions.length) {
            var lion = lions[loopCount];
            var lionItem = document.createElement("option");
            lionItem.value = lion.name;
            lionItem.textContent = lion.name;
            lionSelect.appendChild(lionItem);
        
            loopCount += 1;
        }
        
        lionSelect.selectedIndex = selectedLion;
    };

    var textBoxKeyPress = function (event) {
        console.log(event.charCode);
        if (event.charCode == 13) {
            nameTheLion();
        }
    };
    
    var nameTheLion = function () {
        var nameTextbox = document.getElementById("nameTextbox");

        lionInfo.name = nameTextbox.value;
        
        updateSaveData();
        updatePage();
    };
    
    var selectLion = function (element) {
        //console.log(element.value);
        //console.log(element.selectedIndex);
        selectedLion = lionSelect.selectedIndex;

        lionInfo = lions[selectedLion];
        updatePage();
    };
    
    var updateSaveData = function () {
        var saveData = {};
        saveData.lions = lions;
        
        update_game_from_object(saveData);
        save_game_into_cookie();
    };
</script>
<script src=save.js></script>

</html>