<html>

<head>
    <title>
        Laser Lions
    </title>
    <link rel="icon" href="../images/icon.ico" />

    <style>
        img {
            image-rendering: pixelated;
            cursor: pointer;
        }
        
        td {
            width: 64px;
            height: 64px;
            padding: 0;
        }
        
        table {
            border-collapse: collapse;
            background-image: url("../images/sand.jpg");
        }
        
        input.menuButton {
            float: right;
        }
    </style>

</head>

<body onload="setupPage('area')">
    <input type="button" value="menu" onclick="toMenu()" class="menuButton" />
    <input type="button" value="update" onclick="clickForceUpdate()" class="menuButton" />
    <h1>
		Laser Lions
	</h1>
    <div id="menuDiv"></div>
    <table id="areaTable"> </table>
</body>

<script>
    var rowsToCreate = 5;
    var colsToCreate = 5;

    var updateAreaPage = function () {
        var areaTable = document.getElementById("areaTable");

        //clear table
        while (areaTable.rows.length > 0) {
            areaTable.deleteRow(0);
        }

        var rowIndex = 0;
        while (rowIndex < rowsToCreate) {
            var row = areaTable.insertRow(-1);

            var colIndex = 0;
            while (colIndex < colsToCreate) {
                var col = row.insertCell(-1);

                colIndex += 1;
            }
            rowIndex += 1;
        }
        distributeLions();
    };

    var distributeLions = function () {
        var areaTable = document.getElementById("areaTable");

        var unplacedLions = lions.slice(0);

        while (unplacedLions.length > 0) {

            var rowIndex = Math.floor(Math.random() * rowsToCreate);
            var colIndex = Math.floor(Math.random() * colsToCreate);

            var row = areaTable.rows[rowIndex];
            var col = row.cells[colIndex];

            if (col.children.length == 0) {
                var div = document.createElement("div");
                div.style.position = "relative";
                div.style.width = "64px";
                div.style.height = "64px";

                var lionIndex = Math.floor(Math.random() * unplacedLions.length);
                var lionInfo = unplacedLions[lionIndex];
                unplacedLions.splice(lionIndex, 1);

                var img = document.createElement("img");
                img.src = "../images/Sprite2biggermane.png";
                img.style.visibility = "hidden";
                img.width = 64;
                img.height = 64;
                img.style.position = "absolute";
                img.style.top = 0;
                img.style.left = 0;
                img.style.zIndex = 1;
                img.dataset.lionIndex = getLionIndexByName(lionInfo.name);
                img.onclick = function () {
                    clickLionIcon(this);
                };
                col.appendChild(div);
                div.appendChild(img);

                var imageSrc = "../images/Sprite2biggermane.png";

                updateLionColors(img, imageSrc, lionInfo, true);


                if (lionInfo.desires.length > 0) {
                    var img = document.createElement("img");
                    img.src = "../images/bubble.png";
                    img.style.position = "absolute";
                    img.style.top = 0;
                    img.style.left = 0;
                    img.style.zIndex = 2;
                    img.style.transform = "scaleX(-1)";
                    div.appendChild(img);

                }
            }
        }

    };

    var clickLionIcon = function (element) {

        var lionIndex = element.dataset.lionIndex;
        var lionInfo = lions[lionIndex];

        //alert("Clicked on " + lionInfo.name + "!");
        selectedLion = lionIndex;
        updateSaveData();
        window.location.replace("closeup.html");
    };
</script>

<script src="../js/save.js"></script>
<script src="../js/back.js"></script>
<script src="../js/front.js"></script>
<script src="../js/color.js"></script>
<script src="../js/data.js"></script>

</html>